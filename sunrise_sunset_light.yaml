blueprint:
  name: Actions at Sunrise and Sunset Elevation
  description: Turn a light on at sunrise and off at sunset based on sun elevation, with separate elevation shift values for sunrise and sunset.
  domain: automation
  input:
    divider_startup:
      name: Startup Settings
      description: ""
      selector:
        text:
          type: section
    trigger_at_startup:
      name: Trigger at Startup
      description: Whether to trigger actions at startup if elevation conditions are met.
      default: true
      selector:
        boolean:
    divider_sunrise:
      name: Sunrise Settings
      description: ""
      selector:
        text:
          type: section
    sunrise_elevation_shift:
      name: Sunrise Elevation Shift
      description: Elevation shift value to compare against for sunrise (-6° to 6°).
      default: 0
      selector:
        number:
          min: -6
          max: 6
          unit_of_measurement: "°"
    divider_sunset:
      name: Sunset Settings
      description: ""
      selector:
        text:
          type: section
    sunset_elevation_shift:
      name: Sunset Elevation Shift
      description: Elevation shift value to compare against for sunset (-6° to 6°).
      default: 0
      selector:
        number:
          min: -6
          max: 6
          unit_of_measurement: "°"
    divider_light:
      name: Light Settings
      description: ""
      selector:
        text:
          type: section
    target_light:
      name: Target Light
      description: The light to control at sunrise and sunset.
      selector:
        entity:
          domain: light


variables:
  trigger_at_startup: !input trigger_at_startup
  sunrise_elevation_shift: !input sunrise_elevation_shift
  sunset_elevation_shift: !input sunset_elevation_shift
  target_light: !input target_light

trigger:
  - platform: numeric_state
    entity_id: sun.sun
    attribute: elevation
    above: 0
  - platform: numeric_state
    entity_id: sun.sun
    attribute: elevation
    below: 0
  - platform: homeassistant
    event: start

condition:
  - condition: or
    conditions:
      # Sunrise condition
      - condition: and
        conditions:
          - condition: state
            entity_id: sun.sun
            attribute: rising
            state: 'true'
          - condition: template
            value_template: >-
              {{ trigger.platform != "homeassistant" or 
                 (trigger_at_startup and state_attr("sun.sun", "elevation") >= sunrise_elevation_shift) }}
      # Sunset condition
      - condition: and
        conditions:
          - condition: state
            entity_id: sun.sun
            attribute: rising
            state: 'false'
          - condition: template
            value_template: >-
              {{ trigger.platform != "homeassistant" or 
                 (trigger_at_startup and state_attr("sun.sun", "elevation") <= sunset_elevation_shift) }}

action:
  - choose:
      - conditions:
          - condition: state
            entity_id: sun.sun
            attribute: rising
            state: 'true'
        sequence:
          # Action for sunrise: Turn on the light
          - service: light.turn_on
            target:
              entity_id: "{{ target_light }}"
      - conditions:
          - condition: state
            entity_id: sun.sun
            attribute: rising
            state: 'false'
        sequence:
          # Action for sunset: Turn off the light
          - service: light.turn_off
            target:
              entity_id: "{{ target_light }}"
    default: []

mode: single
